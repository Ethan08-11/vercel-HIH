# 快速同步指南

## 🚀 快速开始

### 方法一：使用同步脚本（最简单）

1. **获取 MongoDB 连接字符串**
   - 登录 Zeabur 控制台
   - 找到 MongoDB 服务
   - 复制 `MONGODB_URI` 环境变量值

2. **创建 .env 文件**
   ```env
   MONGODB_URI=你的MongoDB连接字符串
   DB_NAME=questionnaire
   ```

3. **运行同步命令**
   ```bash
   npm run sync
   ```
   或
   ```bash
   node sync-data.js
   ```

4. **查看结果**
   - 数据保存在 `data/` 文件夹
   - 统计信息在 `data/statistics.json`

### 方法二：使用网页导出（无需配置）

1. **访问统计页面**
   ```
   https://questionnaire-app.zeabur.app/统计页面.html
   ```

2. **点击"📥 导出数据"按钮**

3. **下载的 JSON 文件包含所有数据**

## 📁 数据保存位置

同步后的数据保存在：
- `data/` - 所有提交记录（JSON 文件）
- `data/products/` - 按产品分类的提交记录
- `data/statistics.json` - 统计信息汇总

## 🔍 查看数据

### 查看所有提交记录
```bash
# 查看 data 文件夹
dir data

# 查看统计信息
type data\statistics.json
```

### 使用 API 查看（在线）
- 所有提交：`https://questionnaire-app.zeabur.app/api/submissions`
- 统计信息：`https://questionnaire-app.zeabur.app/api/statistics`
- 导出数据：`https://questionnaire-app.zeabur.app/api/export`

## ⚙️ 配置说明

### .env 文件示例
```env
# MongoDB 连接字符串（从 Zeabur 的 "MongoDB connection string" 字段复制）
MONGODB_URI=mongodb://mongo:你的密码@sjc1.clusters.zeabur.com:23654/questionnaire?authSource=admin

# 数据库名称（可选，默认为 questionnaire）
DB_NAME=questionnaire
```

**重要提示：**
- 使用 Zeabur 页面上的 **"MongoDB connection string"** 字段（完整连接字符串）
- 将连接字符串中的密码部分替换为实际的密码
- 如果密码包含特殊字符，需要进行 URL 编码（@ → %40, # → %23 等）

### 环境变量说明
- `MONGODB_URI`: MongoDB 连接字符串（必需）
- `DB_NAME`: 数据库名称（可选，默认：questionnaire）

## 📊 数据格式

每个提交记录包含：
- `submissionId`: 提交ID（时间戳）
- `productId`: 产品ID
- `productName`: 产品名称
- `productImage`: 产品图片路径
- `answers`: 用户选择的答案
- `selectedProducts`: 选中的产品列表
- `timestamp`: 提交时间（ISO格式）
- `submittedAt`: 提交时间（本地格式）

## 🔄 定期同步

### Windows 定时任务
```cmd
# 每天上午 9 点同步
schtasks /create /tn "同步问卷数据" /tr "cd C:\Users\30543\Desktop\Questionnaire && npm run sync" /sc daily /st 09:00
```

### Linux/Mac 定时任务
```bash
# 编辑 crontab
crontab -e

# 添加以下行（每天上午 9 点同步）
0 9 * * * cd /path/to/Questionnaire && npm run sync >> sync.log 2>&1
```

## ❓ 常见问题

**Q: 提示找不到 MongoDB？**
A: 检查 `.env` 文件中的 `MONGODB_URI` 是否正确

**Q: 同步失败？**
A: 确保网络可以访问 MongoDB，检查防火墙设置

**Q: 数据在哪里？**
A: 查看 `data/` 文件夹，所有 JSON 文件都在那里

**Q: 如何查看统计？**
A: 打开 `data/statistics.json` 或访问统计页面

## 📝 更多信息

详细说明请查看 `数据同步说明.md`

