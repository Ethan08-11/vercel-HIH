# Zeabur Runtime Logs 为空问题排查指南

## 🔴 问题描述

**症状**：Zeabur Runtime Logs 显示 "Waiting for runtime logs..." 或 "No logs found with current settings."

**可能原因**：
1. 服务未启动（启动前崩溃）
2. 日志输出被缓冲，未立即显示
3. 服务启动失败但没有输出错误
4. 构建失败，服务未部署成功

---

## 🔍 排查步骤

### 步骤 1：检查 Build Logs（最重要）

1. 在服务详情页，切换到 **"Build Logs"** 或 **"构建日志"** 标签
2. 查看构建是否成功

**✅ 构建成功**：
```
✅ Build completed successfully
```

**❌ 构建失败**：
```
❌ Build failed
Error: ...
```

**如果构建失败**：
- 查看具体错误信息
- 通常是依赖安装失败、代码语法错误等
- 修复后重新部署

---

### 步骤 2：检查服务状态

1. 在服务详情页，查看服务状态
2. 确认状态是否为 **"RUNNING"**

**状态说明**：
- **RUNNING**：服务正在运行（但可能没有日志输出）
- **BUILDING**：正在构建中
- **FAILED**：构建或启动失败
- **STOPPED**：服务已停止

---

### 步骤 3：触发日志输出

如果服务状态是 "RUNNING" 但日志为空：

**方法 1：访问应用 URL**
1. 访问你的应用 URL（如 `https://your-app.zeabur.app`）
2. 这会触发 HTTP 请求，应该能看到请求日志

**方法 2：访问健康检查端点**
1. 访问 `https://your-app.zeabur.app/health`
2. 应该能看到请求日志和响应

**方法 3：等待心跳日志**
- 代码中已配置每 30 秒输出一次心跳日志
- 等待 30-60 秒后查看日志

---

### 步骤 4：检查环境变量

1. 进入服务详情页
2. 切换到 **"Environment Variables"** 或 **"环境变量"**
3. 确认以下环境变量已设置：
   - `MONGODB_URI`（必需）
   - `DB_NAME`（推荐）

---

## 🔧 解决方案

### 解决方案 1：增强日志输出（已实现）

代码已更新，确保在模块加载的最早阶段就有日志输出：

```javascript
// 在模块加载时立即输出
process.stdout.write('🚀 Node.js 应用开始启动\n');
process.stdout.write('⏰ 时间: ...\n');
process.stdout.write('📦 Node版本: ...\n');
// ... 更多日志
```

**下一步**：
1. 提交并推送代码到 GitHub
2. 等待 Zeabur 自动重新部署
3. 查看 Runtime Logs

---

### 解决方案 2：检查代码语法错误

**检查方法**：
1. 在本地运行 `node server.js`
2. 如果有语法错误，会立即显示

**常见错误**：
- 缺少括号、引号等
- 模块导入错误
- 变量未定义

---

### 解决方案 3：检查依赖安装

**检查方法**：
1. 查看 Build Logs
2. 查找 `npm install` 或 `npm ci` 的输出
3. 确认所有依赖都安装成功

**如果依赖安装失败**：
- 检查 `package.json` 是否正确
- 确认所有依赖版本兼容
- 查看具体错误信息

---

### 解决方案 4：手动触发重新部署

1. 在服务详情页，点击 **"Redeploy"** 或 **"重新部署"**
2. 等待部署完成
3. 查看 Runtime Logs

---

## 📋 预期日志输出

部署成功后，Runtime Logs 应该显示：

```
============================================================
🚀 Node.js 应用开始启动
============================================================
⏰ 时间: 2025-01-XX...
📦 Node版本: v18.x.x
📁 工作目录: /app
🆔 进程ID: 12345
🌍 平台: linux
💻 架构: x64

📋 环境变量检查:
   NODE_ENV: production
   PORT: 3000
   MONGODB_URI: 已设置（长度: 110）
   DB_NAME: questionnaire
   ZEABUR: 1
============================================================
📋 开始加载模块...
✅ Express 模块已加载
✅ 所有模块加载完成，准备初始化服务器...

============================================================
📋 服务器启动流程开始
============================================================
   进程ID: 12345
   平台: linux
   架构: x64

📋 环境变量检查:
   NODE_ENV: production
   PORT: 3000
   MONGODB_URI: 已设置（长度: 110）
   DB_NAME: questionnaire
   ZEABUR: 1

🔄 开始初始化服务器...
🚀 开始初始化服务器...
...
✅ 服务器初始化完成！
   服务器已就绪，等待请求...
```

---

## 🚨 如果仍然没有日志

### 可能原因 1：服务完全崩溃

**检查方法**：
1. 查看 Build Logs 确认构建成功
2. 检查服务状态是否为 "RUNNING"
3. 如果状态不是 "RUNNING"，查看错误信息

### 可能原因 2：Zeabur 日志系统问题

**解决方案**：
1. 等待 2-3 分钟
2. 刷新页面
3. 尝试访问应用 URL 触发日志
4. 如果持续无日志，可能是 Zeabur 平台问题

### 可能原因 3：代码在启动前就出错

**检查方法**：
1. 在本地运行 `node server.js`
2. 查看是否有错误输出
3. 修复错误后重新部署

---

## ✅ 验证清单

完成以下检查：

- [ ] **Build Logs**：构建是否成功？
- [ ] **服务状态**：是否为 "RUNNING"？
- [ ] **环境变量**：`MONGODB_URI` 是否已设置？
- [ ] **代码语法**：本地运行是否有错误？
- [ ] **依赖安装**：所有依赖是否安装成功？
- [ ] **访问应用**：是否尝试访问应用 URL？
- [ ] **等待时间**：是否等待了足够的时间（1-2 分钟）？

---

## 🔗 相关文档

- [Zeabur未知错误排查指南.md](./Zeabur未知错误排查指南.md) - 通用错误排查
- [MongoDB连接字符串验证.md](./MongoDB连接字符串验证.md) - MongoDB 连接配置

---

## 💡 下一步操作

1. **立即操作**：
   - 查看 Build Logs 确认构建成功
   - 检查服务状态
   - 访问应用 URL 触发日志

2. **如果构建成功但日志仍为空**：
   - 等待 1-2 分钟
   - 刷新 Runtime Logs 页面
   - 访问 `/health` 端点

3. **如果构建失败**：
   - 查看具体错误信息
   - 修复代码问题
   - 重新推送代码

---

## 📞 需要帮助？

如果按照以上步骤操作后仍然没有日志：

1. **收集信息**：
   - Build Logs 的完整输出
   - 服务状态
   - 环境变量配置（隐藏敏感信息）
   - 本地运行 `node server.js` 的输出

2. **检查 Zeabur 状态**：
   - 访问 Zeabur 状态页面
   - 查看是否有平台级别的故障

3. **联系支持**：
   - 如果问题持续，联系 Zeabur 支持团队
   - 提供收集到的信息
