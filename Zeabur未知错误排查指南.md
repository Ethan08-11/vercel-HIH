# Zeabur "Unknown error occurred" 错误排查指南

## 🔴 错误信息

**错误提示**：`Unknown error occurred`（未知错误）

这是一个**通用错误消息**，Zeabur 平台在无法确定具体错误时显示。需要查看详细日志来诊断问题。

---

## 🔍 排查步骤

### 步骤 1：查看 Runtime Logs（最重要）

1. 进入 Zeabur 控制台
2. 找到你的后端服务（如 `questionnaire-backend`）
3. 点击进入服务详情页
4. 切换到 **"Runtime Logs"** 或 **"运行时日志"** 标签
5. **查看最新的错误日志**

**查找以下关键信息**：

#### ✅ 如果看到 MongoDB 连接错误：
```
❌ MongoDB 连接失败
   错误消息: ...
   端口号: ...
```

**解决方案**：参考 [数据库连接问题排查](#mongodb-连接问题)

#### ✅ 如果看到应用启动错误：
```
❌ 服务器启动失败
   错误消息: ...
```

**解决方案**：参考 [应用启动问题排查](#应用启动问题)

#### ✅ 如果看到端口占用错误：
```
EADDRINUSE: 端口已被占用
```

**解决方案**：检查环境变量 `PORT` 配置

#### ✅ 如果日志为空或显示 "No logs found"：
**可能原因**：
- 应用还未启动
- 日志系统未正常工作
- 服务完全崩溃

**解决方案**：参考 [日志无显示问题排查](#日志无显示问题)

---

## 📋 常见原因和解决方案

### 1. MongoDB 连接问题

#### 症状
- Runtime Logs 显示 MongoDB 连接失败
- 错误信息包含 `timeout`、`ECONNRESET`、`incomplete read` 等

#### 解决方案

**步骤 1：检查 MongoDB 服务状态**
1. 进入 Zeabur 控制台
2. 找到 MongoDB 服务
3. 确认状态为 **"RUNNING"**

**步骤 2：检查端口号**
1. 在 MongoDB 服务页面查看连接信息
2. 记录端口号（如 `25167`）
3. 进入后端服务的环境变量
4. 检查 `MONGODB_URI` 中的端口号是否匹配

**步骤 3：更新环境变量**
1. 在 MongoDB 服务页面复制完整的连接字符串
2. 更新后端服务的 `MONGODB_URI` 环境变量
3. 等待自动重新部署

**步骤 4：验证**
查看 Runtime Logs，应该看到：
```
✅ MongoDB 连接成功
   数据库: questionnaire
```

---

### 2. 应用启动问题

#### 症状
- Runtime Logs 显示应用启动失败
- 错误信息包含 `Cannot find module`、`SyntaxError` 等

#### 解决方案

**步骤 1：检查代码错误**
1. 查看 Runtime Logs 中的具体错误信息
2. 根据错误信息修复代码
3. 提交并推送代码到 GitHub
4. Zeabur 会自动重新部署

**步骤 2：检查依赖**
1. 确认 `package.json` 中的依赖都正确
2. 检查是否有缺失的模块

**步骤 3：检查环境变量**
1. 确认必需的环境变量都已设置
2. 检查环境变量值是否正确

---

### 3. 端口占用问题

#### 症状
- Runtime Logs 显示 `EADDRINUSE`
- 错误信息：端口已被占用

#### 解决方案

**步骤 1：检查 PORT 环境变量**
1. 进入后端服务的环境变量
2. 检查 `PORT` 环境变量
3. 如果未设置，Zeabur 会自动分配端口

**步骤 2：不要手动设置 PORT**
- 在 Zeabur 上，通常不需要手动设置 `PORT`
- 让 Zeabur 自动分配端口

---

### 4. 日志无显示问题

#### 症状
- Runtime Logs 显示 "No logs found" 或 "Waiting for runtime logs..."
- 应用状态显示 "RUNNING" 但看不到日志

#### 解决方案

**步骤 1：等待应用启动**
- 新部署的应用需要 1-2 分钟完全启动
- 等待一段时间后再查看日志

**步骤 2：触发日志输出**
- 访问应用的 URL（如 `https://your-app.zeabur.app`）
- 这会触发请求日志输出

**步骤 3：检查健康检查端点**
- 访问 `/health` 端点（如果已配置）
- 例如：`https://your-app.zeabur.app/health`

---

## 🔧 快速诊断清单

### ✅ 检查清单

- [ ] **MongoDB 服务状态**：是否为 "RUNNING"？
- [ ] **后端服务状态**：是否为 "RUNNING"？
- [ ] **环境变量 `MONGODB_URI`**：端口号是否正确？
- [ ] **Runtime Logs**：是否有错误信息？
- [ ] **最近代码更改**：是否有语法错误？
- [ ] **依赖安装**：`package.json` 是否正确？

---

## 🚨 紧急修复步骤

如果应用完全无法访问，按以下步骤操作：

### 步骤 1：查看 Runtime Logs
```
进入服务 → Runtime Logs → 查看最新错误
```

### 步骤 2：根据错误类型处理

**如果是 MongoDB 连接错误**：
1. 检查 MongoDB 服务状态
2. 更新 `MONGODB_URI` 环境变量（确保端口号正确）
3. 等待重新部署

**如果是应用启动错误**：
1. 查看具体错误信息
2. 修复代码问题
3. 推送代码到 GitHub
4. 等待自动部署

**如果是未知错误**：
1. 尝试重新部署服务
2. 检查所有环境变量
3. 查看 Zeabur 服务状态页面

### 步骤 3：重新部署

如果问题持续：
1. 在服务详情页点击 **"Redeploy"** 或 **"重新部署"**
2. 等待部署完成
3. 再次查看 Runtime Logs

---

## 📊 错误信息对照表

| Runtime Logs 错误信息 | 可能原因 | 解决方案 |
|---------------------|---------|---------|
| `MongoServerSelectionError` | MongoDB 连接失败 | 检查端口号和连接字符串 |
| `ECONNRESET` | 连接被重置 | 检查 MongoDB 服务状态 |
| `incomplete read` | 端口号不匹配 | 更新 `MONGODB_URI` 端口号 |
| `EADDRINUSE` | 端口被占用 | 检查 `PORT` 环境变量 |
| `Cannot find module` | 依赖缺失 | 检查 `package.json` |
| `SyntaxError` | 代码语法错误 | 修复代码错误 |
| `No logs found` | 应用未启动 | 等待启动或检查部署状态 |

---

## 💡 预防措施

### 1. 定期检查日志
- 每天查看一次 Runtime Logs
- 及时发现潜在问题

### 2. 监控 MongoDB 连接
- 确保 MongoDB 服务正常运行
- 定期验证连接状态

### 3. 测试部署
- 在本地测试代码
- 确保没有语法错误
- 验证环境变量配置

### 4. 备份配置
- 记录所有环境变量
- 保存 MongoDB 连接信息

---

## 🔗 相关文档

- [数据库连接与文件存储说明.md](./数据库连接与文件存储说明.md) - 数据库连接问题详细说明
- [配置MongoDB连接.md](./配置MongoDB连接.md) - MongoDB 连接配置指南
- [README_BACKEND.md](./README_BACKEND.md) - 后端服务使用说明

---

## 📞 需要帮助？

如果按照以上步骤操作后仍然无法解决：

1. **收集信息**：
   - Runtime Logs 的完整错误信息
   - MongoDB 服务状态
   - 环境变量配置（隐藏敏感信息）
   - 最近的操作记录

2. **检查 Zeabur 状态**：
   - 访问 Zeabur 状态页面
   - 查看是否有平台级别的故障

3. **联系支持**：
   - 如果问题持续，联系 Zeabur 支持团队
   - 提供收集到的错误信息
