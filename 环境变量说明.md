# 环境变量说明

## 必需环境变量（用于数据库存储）

| 变量名 | 说明 | 示例 | 是否必需 |
|--------|------|------|----------|
| `MONGODB_URI` | MongoDB 连接字符串 | `mongodb+srv://user:pass@cluster.mongodb.net/` | ✅ **必需**（Vercel 部署） |
| `DB_NAME` | 数据库名称 | `questionnaire` | ❌ 可选（默认：`questionnaire`） |

### 如何获取 MongoDB URI？

请参考 [MongoDB配置指南.md](./MongoDB配置指南.md) 获取详细的配置步骤。

## 自动配置的环境变量

以下变量由 Vercel 自动提供，无需手动设置：

| 变量名 | 说明 | 默认值 |
|--------|------|--------|
| `PORT` | 服务器端口 | Vercel 自动分配 |
| `NODE_ENV` | 运行环境 | `production` |
| `VERCEL` | Vercel 环境标识 | `1`（在 Vercel 上） |

## 在 Vercel 中设置环境变量

### 方法1：通过 Vercel 网站（推荐）

1. 登录 [Vercel Dashboard](https://vercel.com/dashboard)
2. 选择您的项目
3. 进入 **Settings** → **Environment Variables**
4. 点击 **Add New**
5. 输入变量名：`MONGODB_URI`
6. 输入值：您的 MongoDB 连接字符串
7. 选择所有环境（Production, Preview, Development）
8. 点击 **Save**
9. 重复步骤 4-8 添加 `DB_NAME`（可选）

### 方法2：通过 Vercel CLI

```bash
# 设置 MongoDB URI
vercel env add MONGODB_URI production
# 输入您的 MongoDB 连接字符串

# 设置数据库名称（可选）
vercel env add DB_NAME production
# 输入：questionnaire

# 查看环境变量
vercel env ls

# 删除环境变量
vercel env rm MONGODB_URI production
```

### 方法3：使用 .env 文件（本地开发）

在项目根目录创建 `.env` 文件：

```env
MONGODB_URI=mongodb+srv://用户名:密码@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority
DB_NAME=questionnaire
```

⚠️ **注意**：`.env` 文件已添加到 `.gitignore`，不会被提交到 Git。

## 本地开发配置

### 安装依赖

```bash
npm install
```

### 启动服务器

```bash
npm start
```

服务器会自动加载 `.env` 文件中的环境变量。

## 重要提示

### ⚠️ 数据存储

**Vercel 是无服务器平台，文件系统是只读的！**

- ✅ **已集成 MongoDB**：项目现在使用 MongoDB 数据库存储数据
- ✅ **自动检测**：代码会自动检测是否配置了数据库
- ✅ **向后兼容**：本地开发时如果没有配置数据库，仍可使用文件系统

### 数据存储优先级

1. **MongoDB 数据库**（如果配置了 `MONGODB_URI`）
2. **文件系统**（仅本地开发，未配置数据库时）

## 验证配置

### 检查环境变量

启动服务器后，查看控制台输出：

- ✅ `✅ MongoDB 连接成功` - 数据库配置正确
- ⚠️ `⚠️ 数据库: 未配置 (使用文件系统，仅本地开发)` - 未配置数据库（仅本地可用）

### 测试数据提交

1. 访问应用
2. 选择产品并提交
3. 在 MongoDB Atlas 中查看数据（如果使用数据库）

## 部署检查清单

- [ ] 已创建 MongoDB Atlas 账户和集群
- [ ] 已获取 MongoDB 连接字符串
- [ ] 已在 Vercel 设置 `MONGODB_URI` 环境变量
- [ ] 已重新部署项目
- [ ] 已验证数据库连接
- [ ] 已测试数据提交功能

## 相关文档

- [MongoDB配置指南.md](./MongoDB配置指南.md) - 详细的 MongoDB 设置步骤
- [Vercel部署指南.md](./Vercel部署指南.md) - Vercel 部署说明
