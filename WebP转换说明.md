# WebP 图片转换说明

## 📋 概述

WebP 是一种现代图片格式，相比 JPG 可以减小 25-35% 的文件大小，同时保持相似的图片质量，显著提升移动端加载速度。

## 🚀 快速开始

### 步骤 1: 安装依赖

```bash
npm install
```

这会自动安装 `sharp` 库（用于图片转换）。

### 步骤 2: 转换图片为 WebP

```bash
npm run convert-webp
```

或者：

```bash
node convert-to-webp.js
```

### 步骤 3: 更新代码（可选）

代码已经更新为自动支持 WebP 格式，并会在浏览器不支持时自动回退到 JPG。

## 📝 详细说明

### convert-to-webp.js

将 `Picture` 文件夹中的所有 JPG 图片转换为 WebP 格式。

**功能：**
- ✅ 自动检测并转换所有 JPG 图片
- ✅ 显示转换前后的文件大小对比
- ✅ 跳过已存在的 WebP 文件
- ✅ 显示压缩率统计

**输出：**
- 在 `Picture` 文件夹中生成对应的 `.webp` 文件
- 保留原始 JPG 文件作为回退

**示例输出：**
```
🔄 转换: 1.jpg → 1.webp
  ✅ 完成: 350.42 KB → 245.30 KB (节省 30.0%)
```

### 代码自动支持

`script.js` 已经更新为：
- ✅ 优先使用 WebP 格式
- ✅ 自动检测浏览器是否支持 WebP
- ✅ 不支持时自动回退到 JPG
- ✅ WebP 加载失败时自动回退到 JPG

## ⚙️ 配置选项

### 调整 WebP 质量

编辑 `convert-to-webp.js`：

```javascript
const QUALITY = 85; // 质量 (1-100, 越高质量越好但文件越大)
const EFFORT = 4;   // 压缩努力程度 (0-6, 越高压缩越好但越慢)
```

**推荐设置：**
- **高质量**: `QUALITY = 90, EFFORT = 6` (文件较大，质量最好)
- **平衡**: `QUALITY = 85, EFFORT = 4` (推荐，平衡质量和大小)
- **高压缩**: `QUALITY = 80, EFFORT = 6` (文件最小，质量略低)

## 📊 预期效果

根据你的图片大小（之前看到 4.jpg 和 5.jpg 都超过 3MB），转换为 WebP 后：

- **原始大小**: ~9.4 MB (所有图片)
- **WebP 大小**: ~6-7 MB (预计节省 25-35%)
- **加载速度**: 提升 25-35%

## 🔄 工作流程

1. **转换图片**
   ```bash
   npm run convert-webp
   ```

2. **检查结果**
   - 查看 `Picture` 文件夹，应该看到 `.webp` 文件
   - 原始 `.jpg` 文件保留作为回退

3. **测试网站**
   - 访问网站，图片应该自动使用 WebP 格式
   - 如果浏览器不支持 WebP，会自动使用 JPG

4. **部署**
   - 将转换后的 WebP 文件一起部署
   - 代码已经支持自动回退，无需额外配置

## 🛠️ 手动转换（如果需要）

如果不想使用脚本，可以使用在线工具：
- [Squoosh](https://squoosh.app/) - Google 的在线图片压缩工具
- [CloudConvert](https://cloudconvert.com/jpg-to-webp) - 在线格式转换

## ❓ 常见问题

### Q: 转换后文件大小没有明显减小？

A: 可能原因：
- 图片已经是高度压缩的 JPG
- 图片包含大量细节和颜色
- 尝试降低 `QUALITY` 值或提高 `EFFORT` 值

### Q: WebP 文件无法加载？

A: 代码已自动处理：
- 浏览器不支持时会自动回退到 JPG
- WebP 加载失败时会自动尝试 JPG
- 确保 JPG 文件仍然存在

### Q: 如何恢复原始设置？

A: 
- WebP 文件可以删除，代码会自动使用 JPG
- 或者修改 `script.js` 中的图片路径

### Q: 转换需要多长时间？

A: 取决于：
- 图片数量和大小
- 设置的 `EFFORT` 值
- 通常每张图片需要几秒到几十秒

## 📈 性能优化建议

1. **使用 WebP**: 已经实现 ✅
2. **图片懒加载**: 已经实现 ✅
3. **预加载关键图片**: 已经实现 ✅
4. **CDN 加速**: 考虑使用 CDN 服务
5. **响应式图片**: 考虑为不同设备提供不同尺寸

## 🎯 下一步

转换完成后：
1. 测试网站加载速度
2. 检查移动端性能
3. 如果满意，可以删除原始 JPG 文件（不推荐，保留作为回退更安全）

